# Implementation Guide - å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚ºã®é€²ã‚æ–¹

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€AIãŒã‚«ã‚¿ãƒ­ã‚°ã‚’ä½¿ã£ã¦**å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º**ã‚’é€²ã‚ã‚‹éš›ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã§ã™ã€‚

> **é‡è¦**: ã“ã®ã‚¬ã‚¤ãƒ‰ã¯**è¨ˆç”»ãŒæ‰¿èªã•ã‚ŒãŸå¾Œ**ã«ä½¿ç”¨ã—ã¾ã™ã€‚
> è¨ˆç”»ãƒ•ã‚§ãƒ¼ã‚ºã«ã¤ã„ã¦ã¯ `catalog/planning/PLANNING_GUIDE.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---

## å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚ºã®å‰ææ¡ä»¶

å®Ÿè£…ã‚’é–‹å§‹ã™ã‚‹å‰ã«ã€ä»¥ä¸‹ãŒå®Œäº†ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªï¼š

```
â–¡ è¨ˆç”»æ›¸ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
â–¡ é©ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ä¸€è¦§ãŒæ±ºå®šã—ã¦ã„ã‚‹
â–¡ é©ç”¨é †åºãŒæ±ºå®šã—ã¦ã„ã‚‹
â–¡ ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‰¿èªã‚’å¾—ã¦ã„ã‚‹
```

**ã“ã‚Œã‚‰ãŒæƒã£ã¦ã„ãªã„å ´åˆã¯ã€è¨ˆç”»ãƒ•ã‚§ãƒ¼ã‚ºã«æˆ»ã£ã¦ãã ã•ã„ã€‚**

---

## å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚ºã®ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: è¨ˆç”»æ›¸ã®ç¢ºèª                                        â”‚
â”‚   â””â”€â”€ é©ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ä¸€è¦§ã‚’ç¢ºèª                                â”‚
â”‚   â””â”€â”€ é©ç”¨é †åºã‚’ç¢ºèª                                        â”‚
â”‚   â””â”€â”€ å½±éŸ¿ç¯„å›²ã‚’ç¢ºèª                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: ãƒ‘ã‚¿ãƒ¼ãƒ³YAMLã®èª­ã¿è¾¼ã¿                              â”‚
â”‚   â””â”€â”€ implementation.template ã‚’å–å¾—                        â”‚
â”‚   â””â”€â”€ ai_guidance.common_mistakes ã‚’ç¢ºèª                    â”‚
â”‚   â””â”€â”€ dependencies ã‚’ç¢ºèª                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ•°ã®ç½®æ›                              â”‚
â”‚   â””â”€â”€ {BoundedContext}, {Entity} ç­‰ã‚’ç½®æ›                   â”‚
â”‚   â””â”€â”€ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®åå‰ç©ºé–“ã‚’é©ç”¨                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ                                          â”‚
â”‚   â””â”€â”€ implementation.file_path ã«å¾“ã£ã¦ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ         â”‚
â”‚   â””â”€â”€ ä¾å­˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã‚³ãƒ¼ãƒ‰ã‚’å…ˆã«ç”Ÿæˆ                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: å®Ÿè£…æ¤œè¨¼                                            â”‚
â”‚   â””â”€â”€ common_mistakes ã®ãƒã‚§ãƒƒã‚¯                            â”‚
â”‚   â””â”€â”€ ãƒ“ãƒ«ãƒ‰ç¢ºèª                                            â”‚
â”‚   â””â”€â”€ å˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: æ¬¡ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¸                                      â”‚
â”‚   â””â”€â”€ é©ç”¨é †åºã«å¾“ã£ã¦ Step 2 ã¸æˆ»ã‚‹                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Step 1: è¨ˆç”»æ›¸ã®ç¢ºèª

### ç¢ºèªã™ã¹ãé …ç›®

è¨ˆç”»æ›¸ã‹ã‚‰ä»¥ä¸‹ã®æƒ…å ±ã‚’æŠ½å‡ºã—ã¾ã™ï¼š

| é …ç›® | ç¢ºèªå†…å®¹ |
|-----|---------|
| é©ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ | ã©ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®Ÿè£…ã™ã‚‹ã‹ |
| é©ç”¨é †åº | ã©ã®é †ç•ªã§å®Ÿè£…ã™ã‚‹ã‹ |
| å½±éŸ¿ç¯„å›² | ã©ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ/å¤‰æ›´ã™ã‚‹ã‹ |
| Boundaryè¨­è¨ˆ | Entity.CanXxx() ã®è¨­è¨ˆ |

### è¨ˆç”»æ›¸ãŒãªã„å ´åˆ

```
âš ï¸ è¨ˆç”»æ›¸ãŒãªã„å ´åˆã¯å®Ÿè£…ã‚’é–‹å§‹ã—ã¦ã¯ã„ã‘ã¾ã›ã‚“ã€‚

è¨ˆç”»ãƒ•ã‚§ãƒ¼ã‚ºã‚’å…ˆã«å®Œäº†ã—ã¦ãã ã•ã„ï¼š
â†’ catalog/planning/PLANNING_GUIDE.md
```

---

## Step 2: ãƒ‘ã‚¿ãƒ¼ãƒ³YAMLã®èª­ã¿è¾¼ã¿

### ãƒ‘ã‚¿ãƒ¼ãƒ³YAMLã®æ§‹é€ 

```yaml
id: feature-create-entity
implementation:
  file_path: "src/Application.Features/Features/{Feature}/{Feature}Command.cs"
  template: |
    // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰

ai_guidance:
  common_mistakes:
    - mistake: "ã‚ˆãã‚ã‚‹ãƒŸã‚¹"
      solution: "è§£æ±ºç­–"

dependencies:
  patterns:
    - validation-behavior
    - transaction-behavior
```

### èª­ã¿è¾¼ã‚€é †åº

```
1. implementation.template   â†’ å®Ÿè£…ã‚³ãƒ¼ãƒ‰ã®é››å½¢
2. implementation.file_path  â†’ ãƒ•ã‚¡ã‚¤ãƒ«é…ç½®å ´æ‰€
3. dependencies.patterns     â†’ å…ˆã«å®Ÿè£…ã™ã¹ããƒ‘ã‚¿ãƒ¼ãƒ³
4. ai_guidance.common_mistakes â†’ å®Ÿè£…æ™‚ã®æ³¨æ„ç‚¹
```

### evidence ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®æ´»ç”¨

```yaml
evidence:
  reference_implementation: "src/Application/Features/CreateProduct/..."
```

**æ—¢å­˜ã®å®Ÿè£…ä¾‹ã‚’å‚ç…§ã™ã‚‹ã“ã¨ã§ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®æ…£ç¿’ã‚’ç¢ºèªã§ãã¾ã™ã€‚**

---

## Step 3: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ•°ã®ç½®æ›

### æ¨™æº–å¤‰æ•°ä¸€è¦§

| å¤‰æ•° | èª¬æ˜ | ä¾‹ |
|-----|------|---|
| `{BoundedContext}` | å¢ƒç•Œã¥ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå | `LibraryManagement` |
| `{Entity}` | ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£åï¼ˆå˜æ•°å½¢ï¼‰ | `Book` |
| `{Entities}` | ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£åï¼ˆè¤‡æ•°å½¢ï¼‰ | `Books` |
| `{Feature}` | æ©Ÿèƒ½å | `CreateBook` |
| `{Aggregate}` | é›†ç´„å | `Books` |
| `{Kernel.Namespace}` | Kernelã®åå‰ç©ºé–“ | `Shared.Kernel` |

### ç½®æ›ä¾‹

```csharp
// Beforeï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼‰
namespace {BoundedContext}.Domain.{Aggregate};

public class {Entity}Id : ValueObject
{
    // ...
}

// Afterï¼ˆç½®æ›å¾Œï¼‰
namespace LibraryManagement.Domain.Books;

public class BookId : ValueObject
{
    // ...
}
```

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®åå‰ç©ºé–“

æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ã‹ã‚‰åå‰ç©ºé–“ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç¢ºèªï¼š

```
src/Domain/{BC}/{Aggregate}/  â†’ {BC}.Domain.{Aggregate}
src/Application.Features/Features/  â†’ Application.Features
src/UI.Blazor/Features/             â†’ Application.Featuresï¼ˆUIï¼‰
src/Kernel/                   â†’ Shared.Kernel
```

---

## Step 4: ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ

### ä¾å­˜é–¢ä¿‚ã«åŸºã¥ãç”Ÿæˆé †åº

ä¾å­˜é–¢ä¿‚ãƒãƒƒãƒ—ï¼ˆ`pattern-combinations.yaml` ã‚ˆã‚Šï¼‰ï¼š

```
Kernelï¼ˆä¾å­˜ãªã—ï¼‰
  â””â”€â”€ result-pattern
  â””â”€â”€ value-object
  â””â”€â”€ entity-base

Domain
  â””â”€â”€ domain-typed-id â†’ value-object
  â””â”€â”€ domain-state-machine â†’ entity-base
  â””â”€â”€ boundary-pattern â†’ entity-base

Infrastructureï¼ˆä¾å­˜ãªã—ï¼‰
  â””â”€â”€ validation-behavior
  â””â”€â”€ transaction-behavior
  â””â”€â”€ logging-behavior

Application
  â””â”€â”€ feature-create-entity â†’ validation, transaction, entity-base
```

### ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ¥ã®å®Ÿè£…é †åº

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 1: Kernelå±¤ï¼ˆé€šå¸¸ã¯æ—¢å­˜åˆ©ç”¨ï¼‰                         â”‚
â”‚   ç¢ºèª: Result<T>, ValueObject, Entity ãŒå­˜åœ¨ã™ã‚‹ã‹         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 2: Domainå±¤ - ID                                      â”‚
â”‚   ä½œæˆ: {Entity}Id.csï¼ˆTypedIdï¼‰                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 3: Domainå±¤ - Entity                                  â”‚
â”‚   ä½œæˆ: {Entity}.cs                                         â”‚
â”‚   å«ã‚€: ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¡ã‚½ãƒƒãƒ‰ã€ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã€CanXxx()      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 4: Domainå±¤ - Boundary                                â”‚
â”‚   ä½œæˆ: {Entity}BoundaryService.csï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰            â”‚
â”‚   æ³¨æ„: æ¥­å‹™ãƒ­ã‚¸ãƒƒã‚¯ã¯ Entity ã«å§”è­²                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 5: Infrastructureå±¤ - Repository                      â”‚
â”‚   ä½œæˆ: I{Entity}Repository.csï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼‰          â”‚
â”‚   ä½œæˆ: {Entity}Repository.csï¼ˆå®Ÿè£…ï¼‰                       â”‚
â”‚   ä½œæˆ: {Entity}Configuration.csï¼ˆEF Coreè¨­å®šï¼‰             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 6: Applicationå±¤ - Command/Query                      â”‚
â”‚   ä½œæˆ: {Feature}Command.cs                                 â”‚
â”‚   ä½œæˆ: {Feature}CommandHandler.cs                          â”‚
â”‚   ä½œæˆ: {Feature}CommandValidator.cs                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 7: UIå±¤                                               â”‚
â”‚   ä½œæˆ: Features/{Feature}/{Feature}.razor                  â”‚
â”‚   æ³¨æ„: æ©Ÿèƒ½å›ºæœ‰UIã¯Featuresãƒ•ã‚©ãƒ«ãƒ€ã«é…ç½®                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Step 5: å®Ÿè£…æ¤œè¨¼

### common_mistakes ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

å„ãƒ‘ã‚¿ãƒ¼ãƒ³ã® `ai_guidance.common_mistakes` ã‚’ç¢ºèªï¼š

```yaml
# ä¾‹: entity-base.yaml
common_mistakes:
  - mistake: "publicã‚»ãƒƒã‚¿ãƒ¼ã‚’æŒã¤"
    solution: "ã‚»ãƒƒã‚¿ãƒ¼ã¯ private ã«"

  - mistake: "publicã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§ç›´æ¥ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–"
    solution: "privateã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ + static Create ãƒ¡ã‚½ãƒƒãƒ‰"
```

### å®Ÿè£…æ™‚ã®å…±é€šãƒã‚§ãƒƒã‚¯

```
â–¡ Handlerå†…ã§ SaveChangesAsync() ã‚’å‘¼ã‚“ã§ã„ãªã„ã‹
  â†’ TransactionBehavior ãŒè‡ªå‹•å®Ÿè¡Œ

â–¡ Result<T> ã§æˆ»ã‚Šå€¤ã‚’ãƒ©ãƒƒãƒ—ã—ã¦ã„ã‚‹ã‹
  â†’ ä¾‹å¤–ã‚’ throw ã—ãªã„

â–¡ Entity ã®ã‚»ãƒƒã‚¿ãƒ¼ãŒ private ã‹
  â†’ æ„å‘³ã®ã‚ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰çµŒç”±ã§å¤‰æ›´

â–¡ Boundary ã®æ¥­å‹™ãƒ­ã‚¸ãƒƒã‚¯ãŒ Entity ã«ã‚ã‚‹ã‹
  â†’ BoundaryService ã¯å§”è­²ã®ã¿

â–¡ UI ãŒ Features/{Feature}/ ã«é…ç½®ã•ã‚Œã¦ã„ã‚‹ã‹
  â†’ Components/Pages/ ã§ã¯ãªã„
```

### ãƒ“ãƒ«ãƒ‰ç¢ºèª

```bash
# ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ãŒãªã„ã“ã¨ã‚’ç¢ºèª
dotnet build

# ç‰¹å®šã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã¿
dotnet build src/Host.Web/Host.Web.csproj
```

---

## Step 6: æ¬¡ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¸

### é€²æ—ç®¡ç†

```markdown
## å®Ÿè£…é€²æ—

| é †åº | ãƒ‘ã‚¿ãƒ¼ãƒ³ | çŠ¶æ…‹ | å‚™è€ƒ |
|:---:|---------|:----:|------|
| 1 | domain-typed-id | âœ… | BookId, MemberId å®Œäº† |
| 2 | entity-base | âœ… | Book, Member å®Œäº† |
| 3 | boundary-pattern | ğŸ”„ | Book.CanBorrow() å®Ÿè£…ä¸­ |
| 4 | feature-create-entity | â³ | æœªç€æ‰‹ |
```

### å®Œäº†æ¡ä»¶

```
â–¡ ã™ã¹ã¦ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå®Ÿè£…ã•ã‚ŒãŸ
â–¡ ãƒ“ãƒ«ãƒ‰ãŒé€šã‚‹
â–¡ åŸºæœ¬çš„ãªå‹•ä½œç¢ºèªãŒã§ãã‚‹
```

---

## å®Ÿè£…æ™‚ã®æ³¨æ„äº‹é …

### 1. SaveChangesAsync ã¯å‘¼ã°ãªã„

```csharp
// âŒ ç¦æ­¢
public async Task<Result<Guid>> Handle(CreateBookCommand request, CancellationToken ct)
{
    var book = Book.Create(request.Title, request.Author);
    await _repository.AddAsync(book, ct);
    await _dbContext.SaveChangesAsync(ct);  // âŒ å‘¼ã°ãªã„ï¼
    return Result.Success(book.Id.Value);
}

// âœ… æ­£ã—ã„
public async Task<Result<Guid>> Handle(CreateBookCommand request, CancellationToken ct)
{
    var book = Book.Create(request.Title, request.Author);
    await _repository.AddAsync(book, ct);
    return Result.Success(book.Id.Value);  // TransactionBehavior ãŒ SaveChanges ã‚’å®Ÿè¡Œ
}
```

### 2. Result<T> ã§ä¾‹å¤–ã‚’ãƒ©ãƒƒãƒ—

```csharp
// âŒ ç¦æ­¢
public async Task<Result<BookDto>> Handle(GetBookQuery query, CancellationToken ct)
{
    var book = await _repository.GetByIdAsync(query.Id, ct);
    if (book == null)
        throw new NotFoundException($"Book {query.Id} not found");  // âŒ
    return Result.Success(new BookDto(book));
}

// âœ… æ­£ã—ã„
public async Task<Result<BookDto>> Handle(GetBookQuery query, CancellationToken ct)
{
    var book = await _repository.GetByIdAsync(query.Id, ct);
    if (book == null)
        return Result.Failure<BookDto>("Book not found");  // âœ…
    return Result.Success(new BookDto(book));
}
```

### 3. Entity ã®æ¥­å‹™ãƒ­ã‚¸ãƒƒã‚¯

```csharp
// âŒ ç¦æ­¢: Handler ã«æ¥­å‹™ãƒ­ã‚¸ãƒƒã‚¯
public async Task<Result<Unit>> Handle(BorrowBookCommand request, CancellationToken ct)
{
    var book = await _repository.GetByIdAsync(request.BookId, ct);

    // âŒ Handler ã«æ¥­å‹™ãƒ­ã‚¸ãƒƒã‚¯ãŒã‚ã‚‹
    if (book.Status != BookStatus.Available)
        return Result.Failure<Unit>("è²¸å‡ºã§ãã¾ã›ã‚“");

    if (book.CopyCount <= 0)
        return Result.Failure<Unit>("åœ¨åº«ãŒã‚ã‚Šã¾ã›ã‚“");

    book.Status = BookStatus.Borrowed;  // âŒ public ã‚»ãƒƒã‚¿ãƒ¼
    // ...
}

// âœ… æ­£ã—ã„: Entity ã«æ¥­å‹™ãƒ­ã‚¸ãƒƒã‚¯
public async Task<Result<Unit>> Handle(BorrowBookCommand request, CancellationToken ct)
{
    var book = await _repository.GetByIdAsync(request.BookId, ct);

    // âœ… Entity ã«å§”è­²
    var canBorrow = book.CanBorrow();
    if (!canBorrow.IsAllowed)
        return Result.Failure<Unit>(canBorrow.Reason);

    book.Borrow(request.MemberId);  // âœ… æ„å‘³ã®ã‚ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰
    // ...
}
```

### 4. TypedId ã® LINQ ã‚¯ã‚¨ãƒª

```csharp
// âŒ ç¦æ­¢: .Value ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§æ¯”è¼ƒ
var book = await _dbContext.Books
    .Where(b => b.Id.Value == requestGuid)  // âŒ EF Core ãŒå¤‰æ›ã§ããªã„
    .FirstOrDefaultAsync(ct);

// âœ… æ­£ã—ã„: TypedId ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§æ¯”è¼ƒ
var bookId = BookId.From(requestGuid);
var book = await _dbContext.Books
    .Where(b => b.Id == bookId)  // âœ… HasConversion ãŒé©ç”¨ã•ã‚Œã‚‹
    .FirstOrDefaultAsync(ct);
```

---

## å®Ÿè£…å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

```
â–¡ Kernelå±¤
  â–¡ Result<T> ãŒå­˜åœ¨ã™ã‚‹ï¼ˆã¾ãŸã¯æ—¢å­˜åˆ©ç”¨ï¼‰
  â–¡ ValueObject ãŒå­˜åœ¨ã™ã‚‹ï¼ˆã¾ãŸã¯æ—¢å­˜åˆ©ç”¨ï¼‰
  â–¡ Entity ãŒå­˜åœ¨ã™ã‚‹ï¼ˆã¾ãŸã¯æ—¢å­˜åˆ©ç”¨ï¼‰

â–¡ Domainå±¤
  â–¡ TypedId ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
  â–¡ Entity ã«ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚ã‚‹
  â–¡ Entity ã« CanXxx() ãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚ã‚‹ï¼ˆBoundaryç”¨ï¼‰
  â–¡ Entity ã®ã‚»ãƒƒã‚¿ãƒ¼ãŒ private ã§ã‚ã‚‹

â–¡ Infrastructureå±¤
  â–¡ Repository ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒã‚ã‚‹
  â–¡ Repository å®Ÿè£…ãŒã‚ã‚‹
  â–¡ EF Core Configuration ãŒã‚ã‚‹ï¼ˆTypedId ã® HasConversionï¼‰
  â–¡ Behaviors ãŒç™»éŒ²ã•ã‚Œã¦ã„ã‚‹

â–¡ Applicationå±¤
  â–¡ Command/Query ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
  â–¡ Handler ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
  â–¡ Handler å†…ã§ SaveChangesAsync ã‚’å‘¼ã‚“ã§ã„ãªã„
  â–¡ Validator ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹

â–¡ UIå±¤
  â–¡ .razor ãŒ Features/{Feature}/ ã«é…ç½®ã•ã‚Œã¦ã„ã‚‹
  â–¡ Components/Pages/ ã«æ©Ÿèƒ½å›ºæœ‰UIãŒãªã„

â–¡ éæ©Ÿèƒ½è¦ä»¶
  â–¡ è¨ˆç”»ã§é¸æŠã—ãŸ Behavior ãŒé©ç”¨ã•ã‚Œã¦ã„ã‚‹
  â–¡ ãƒ‰ãƒ¡ã‚¤ãƒ³æ¨å¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒè€ƒæ…®ã•ã‚Œã¦ã„ã‚‹
```

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼: åå‰ç©ºé–“ãŒè¦‹ã¤ã‹ã‚‰ãªã„

```
åŸå› : using ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã®ä¸è¶³

è§£æ±ºç­–:
1. æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã® using ã‚’å‚ç…§
2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã«åˆã‚ã›ã¦åå‰ç©ºé–“ã‚’èª¿æ•´
```

### ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼: DbContext ãŒ Disposed

```
åŸå› : Singleton ã§ DbContext ã‚’æ³¨å…¥ã—ã¦ã„ã‚‹

è§£æ±ºç­–:
1. ã™ã¹ã¦ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’ Scoped ã§ç™»éŒ²
2. services.AddScoped<IXxxRepository, XxxRepository>();
```

### EF Core: TypedId ã®æ¯”è¼ƒãŒå¤±æ•—

```
åŸå› : LINQ ã§ .Value ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ä½¿ã£ã¦ã„ã‚‹

è§£æ±ºç­–:
1. TypedId ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§æ¯”è¼ƒã™ã‚‹
2. BookId.From(guid) ã‚’ä½¿ç”¨
```

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [PLANNING_GUIDE.md](../planning/PLANNING_GUIDE.md) - è¨ˆç”»ãƒ•ã‚§ãƒ¼ã‚ºã®é€²ã‚æ–¹
- [pattern-combinations.yaml](../planning/pattern-combinations.yaml) - ãƒ‘ã‚¿ãƒ¼ãƒ³çµ„ã¿åˆã‚ã›ä¾‹
- [COMMON_MISTAKES.md](../COMMON_MISTAKES.md) - ã‚ˆãã‚ã‚‹ãƒŸã‚¹
- [AI_USAGE_GUIDE.md](../AI_USAGE_GUIDE.md) - AIåˆ©ç”¨ã‚¬ã‚¤ãƒ‰

---

**æœ€çµ‚æ›´æ–°**: 2025-11-27
**ã‚«ã‚¿ãƒ­ã‚°ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v2025.11.27.1
