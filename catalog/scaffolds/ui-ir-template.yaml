# catalog/scaffolds/ui-ir-template.yaml
# UI Intermediate Representation (UI-IR)
# Purpose: Bridge ICONIX Boundary -> High-quality UI generation (MudBlazor)
#
# vNext (v0.2.0): Maturity-based UI vocabulary constraints
# - Model maturity (boundary → entity → view) controls allowed UI widgets
# - Prevents premature UI complexity based on model concreteness

id: ui-ir-template
version: 0.2.0
name: UI Intermediate Representation Template
category: scaffold
intent: AIがUI生成時に「UX品質を担保するための中間表現」。boundary-pattern/spec-templateを補完し、情報優先度・操作頻度・確認要否などを定量化する。

ui_ir:
  version: "0.1"
  description: >
    UI-IR is a UI intermediate representation optimized for LLM-driven UI generation.
    It encodes priorities, frequency, safety, and UX constraints so the generated UI is not "flat".

# -----------------------------------------------------------------------------
# Enumerations (MUST use these values)
# -----------------------------------------------------------------------------
enums:
  importance: [Critical, Primary, Secondary, Reference]
  action_priority: [Primary, Secondary, Tertiary]
  frequency: [VeryHigh, High, Medium, Low, Rare]
  reversibility: [Reversible, PartiallyReversible, Irreversible]
  error_cost: [Negligible, Low, Medium, High, Critical]
  confirmation_level: [None, Simple, Detailed, DoubleConfirm]

  layout_kind:
    information_blocks: [table, card, list, inline, alert, tabs, accordion]
    forms: [single_column, two_column, wizard, inline]

  field_type: [text, multiline, number, select, multiselect, date, datetime, checkbox, toggle, file, search]

  # Navigation and data binding enums
  navigation_type: [push, replace, dialog, modal]
  caching_strategy: [none, memory, etag, localStorage]
  severity: [High, Medium, Low, Info]

  data_binding:
    source_kind: [Query, Command, LocalState]
    refresh_mode: [OnLoad, OnAction, Polling]
    validation_mode: [Client, Server, Both]

  # vNext: Maturity-based enums
  maturity_level: [boundary, entity, view]
  comparability_mode: [rows, columns, time]
  override_scope: [screen, concern, block]

  # Widget classification by maturity level
  widgets:
    boundary: [inline-sections, card, list, flow, simple-list]
    entity: [inline-sections, card, list, flow, simple-list, accordion, data-grid, grouping]
    view: [inline-sections, card, list, flow, simple-list, accordion, data-grid, grouping, tab, master-detail, stepper]
    upper_only: [tab, master-detail, stepper]  # view level only

# -----------------------------------------------------------------------------
# Component mapping (MudBlazor)
# -----------------------------------------------------------------------------
component_mapping:
  # Note: Keys in frequency-specific mappings use enum values exactly (case-sensitive)
  actions:
    Primary:
      default: 'MudButton(Variant="Filled", Color="Primary")'
      VeryHigh: 'MudButton(Variant="Filled", Color="Primary", Size="Large")'
    Secondary:
      default: 'MudButton(Variant="Outlined")'
    Tertiary:
      default: 'MudButton(Variant="Text")'
      Rare: 'MudMenuItem'
    danger_overrides:
      # Applied when is_destructive: true OR error_cost is High/Critical
      High: 'MudButton(Variant="Filled", Color="Error")'
      Critical: 'MudButton(Variant="Filled", Color="Error", Size="Large")'

  information_blocks:
    Critical: 'MudAlert(Severity="Warning")'
    Primary: 'MudPaper(Elevation="1")'
    Secondary: 'MudPaper(Outlined="true")'
    Reference: 'MudExpansionPanels()'
    layouts:
      table: 'MudDataGrid'
      card: 'MudCard'
      list: 'MudList'
      tabs: 'MudTabs'
      accordion: 'MudExpansionPanels'
      alert: 'MudAlert'
      inline: 'MudStack'

  form_fields:
    text: 'MudTextField'
    multiline: 'MudTextField(Lines="4")'
    number: 'MudNumericField'
    select: 'MudSelect'
    multiselect: 'MudSelect(MultiSelection="true")'
    date: 'MudDatePicker'
    datetime: 'MudDatePicker'
    checkbox: 'MudCheckBox'
    toggle: 'MudSwitch'
    file: 'MudFileUpload'
    search: 'MudAutocomplete'

# -----------------------------------------------------------------------------
# Derivation rules (these MUST be applied by generators)
# -----------------------------------------------------------------------------
rules:
  # Single primary action rule
  primary_action_uniqueness:
    must_have_exactly_one: true
    message: "Each screen MUST have exactly one Primary action."

  # Confirmation level auto-derivation
  confirmation_level_derivation:
    algorithm: |
      if error_cost in [Negligible, Low] and reversibility == Reversible:
        confirmation_level = None
      elif error_cost == Medium:
        confirmation_level = Simple
      elif error_cost == High:
        confirmation_level = Detailed
      elif error_cost == Critical or reversibility == Irreversible:
        confirmation_level = DoubleConfirm
    examples:
      - input: { error_cost: Low, reversibility: Reversible }
        output: { confirmation_level: None }
      - input: { error_cost: High, reversibility: PartiallyReversible }
        output: { confirmation_level: Detailed }
      - input: { error_cost: Medium, reversibility: Reversible }
        output: { confirmation_level: Simple }
      - input: { error_cost: Low, reversibility: Irreversible }
        output: { confirmation_level: DoubleConfirm }

  # Placement rules (prevent "flat" UI)
  placement:
    critical_first_view:
      must_be_visible_without_scrolling: true
    primary_action_prominence:
      must_be_above_fold: true
      must_be_single_visual_dominant: true
    high_frequency_reachability:
      description: "VeryHigh/High actions MUST be reachable within one interaction from default screen state."
      max_clicks: 1

  # Boundary decision wiring rule
  boundary_decision_binding:
    description: "Actions SHOULD reference boundary decisions (Entity.CanXxx()) to control enabled/disabled."
    require_ref_when_available: true

  # Destructive action styling rule
  destructive_action_styling:
    description: "Actions with is_destructive: true MUST use danger_overrides styling."
    algorithm: |
      if is_destructive == true:
        use component_mapping.actions.danger_overrides[error_cost]
      elif error_cost in [High, Critical]:
        use component_mapping.actions.danger_overrides[error_cost]

# -----------------------------------------------------------------------------
# vNext: Maturity defaults (injected at Template generation time)
# -----------------------------------------------------------------------------
maturity_defaults:
  description: |
    These defaults are PHYSICALLY EMBEDDED into the generated UI-IR at Template time.
    This makes the UI-IR self-contained and reviewable without external reference.
    Injection happens during spec-kit plan → UI-IR generation.

  boundary:
    allowed_widgets:
      - inline-sections
      - card
      - list
      - flow
      - simple-list
    denied_widgets:
      - tab
      - master-detail
      - stepper
      - accordion
      - data-grid
    allowed_affordances:
      - navigation
    allowed_patterns:
      - FlowLayout

  entity:
    allowed_widgets:
      - inline-sections
      - card
      - list
      - flow
      - simple-list
      - accordion
      - data-grid
      - grouping
    denied_widgets:
      - tab
      - master-detail
      - stepper
    allowed_affordances:
      - navigation
      - comparison
      - bulk-action
    allowed_patterns:
      - FlowLayout
      - ConcernSwitch
      - CollectionBrowse

  view:
    allowed_widgets:
      - inline-sections
      - card
      - list
      - flow
      - simple-list
      - accordion
      - data-grid
      - grouping
      - tab
      - master-detail
      - stepper
    denied_widgets: []
    allowed_affordances:
      - navigation
      - comparison
      - bulk-action
      - exclusive-switch
      - progressive-input
    allowed_patterns:
      - FlowLayout
      - ConcernSwitch
      - CollectionBrowse
      - MasterDetail
    requires:
      - "stability.concerns_unchanged_since != null"

  injection_rules:
    description: |
      When generating UI-IR, the generator MUST:
      1. Determine maturity.level from model concreteness
      2. Copy the corresponding defaults into uiPolicy
      3. Set denied_widgets based on maturity level
      4. The output UI-IR contains the full uiPolicy (not just a reference)
    algorithm: |
      level = screen.maturity.level
      defaults = maturity_defaults[level]
      screen.uiPolicy.allowed_widgets = defaults.allowed_widgets
      screen.uiPolicy.denied_widgets = defaults.denied_widgets
      screen.uiPolicy.allowed_affordances = defaults.allowed_affordances
      screen.uiPolicy.allowed_patterns = defaults.allowed_patterns

# -----------------------------------------------------------------------------
# UX review (self-checklist & scoring rubric)
# -----------------------------------------------------------------------------
ux_review:
  mandatory_checks:
    - id: UX-001
      statement: "Primary アクションは画面に1つのみか"
      severity: High
    - id: UX-002
      statement: "Irreversible または error_cost>=High のアクションに確認があるか（派生ルール一致）"
      severity: High
    - id: UX-003
      statement: "Critical importance の情報がファーストビューに表示されるか"
      severity: High
    - id: UX-004
      statement: "境界の意思決定（Entity.CanXxx()）がUIのdisabled等に反映されているか"
      severity: Medium
    - id: UX-005
      statement: "VeryHigh/High の操作が1クリック以内で到達できるか"
      severity: Medium

    # vNext: Maturity-based checks
    - id: UX-006
      statement: "maturity.level に対して allowed_widgets が適切か（上位widget禁止ルール）"
      severity: High
      vNext: true
    - id: UX-007
      statement: "view レベルの場合、stability.concerns_unchanged_since が設定されているか"
      severity: High
      vNext: true
    - id: UX-008
      statement: "exclusivity=true の concern が複数ある場合、exclusive-switch が許可されているか"
      severity: Medium
      vNext: true
    - id: UX-009
      statement: "comparability が定義されている concern に対して comparison affordance が許可されているか"
      severity: Medium
      vNext: true
    - id: UX-010
      statement: "information_blocks がすべて concerns から参照されているか（孤立ブロック検出）"
      severity: Low
      vNext: true

  scoring:
    weights:
      discoverability: 0.30
      safety: 0.25
      efficiency: 0.25
      consistency: 0.20
    scale: "0..5"
    guidance:
      5: "Excellent - minimal friction, safe defaults, consistent patterns"
      3: "OK - usable but some friction or minor inconsistencies"
      1: "Poor - confusing, unsafe, or inefficient"

# -----------------------------------------------------------------------------
# Schema template (Fill this per screen)
# -----------------------------------------------------------------------------
schema:
  screen:
    id: ""                 # e.g., "product.search"
    name: ""               # e.g., "Product Search"
    purpose: ""            # user-facing purpose sentence
    primary_user_intent: ""# e.g., "Find a product quickly and open details"
    personas: []           # optional: ["Librarian", "Admin"]
    entry_conditions: []   # optional: ["UserAuthenticated"]
    exit_conditions: []    # optional: ["NavigatedToProductDetail"]
    notes: ""              # optional

  # ---------------------------------------------------------------------------
  # vNext: Maturity-based constraints (v0.2.0)
  # ---------------------------------------------------------------------------
  maturity:
    level: "entity"                    # boundary | entity | view
    gate_evidence:
      boundary_to_entity:              # Evidence for entity-level maturity
        - "data-model.md で Entity 属性確定"
        - "form_fields 全項目定義済み"
      entity_to_view: []               # Evidence for view-level maturity
    stability:
      concerns_unchanged_since: null   # Plan reference (e.g., "plan#3") - REQUIRED for view level
      routes_unchanged_since: null     # Plan reference for route stability
      main_actions_complete: false     # All main actions have corresponding CanXxx()

  structure:
    subject: ""                        # Primary subject (Aggregate Root)
    concerns:
      - id: ""                         # e.g., "overview"
        name: ""                       # e.g., "基本情報"
        blocks: []                     # References to information_blocks.id
        exclusivity: false             # If true, should not be displayed simultaneously with other exclusive concerns
        comparability:                 # Optional: comparison display support
          mode: ""                     # rows | columns | time
          key: ""                      # Key field for comparison (e.g., "loanDate")

  uiPolicy:
    allowed_patterns: []               # e.g., ["ConcernSwitch", "CollectionBrowse"]
    allowed_affordances: []            # e.g., ["exclusive-switch", "comparison"]
    allowed_widgets: []                # e.g., ["accordion", "data-grid"]
    denied_widgets: []                 # e.g., ["tab", "master-detail"]

  uiPolicyOverrides:
    - allow_widget: ""                 # Widget to allow despite maturity constraints
      reason: ""                       # Justification (min 10 chars)
      approved_by: ""                  # Approver (e.g., "UX", "Tech Lead")
      approved_at: ""                  # Date of approval (YYYY-MM-DD)
      violation_id: ""                 # ID of the lint rule being waived (e.g., "MATURITY-001")
      scope: ""                        # screen | concern | block

  navigation:
    routes:
      - from_screen_id: ""
        to_screen_id: ""
        trigger: ""        # action_id or event
        type: ""           # push | replace | dialog | modal (enums.navigation_type)
    breadcrumbs: []        # optional
    deep_links: []         # optional

  data:
    bindings:
      - id: ""                       # "products.search"
        source_kind: "Query"         # Query | Command | LocalState
        source_ref: ""               # e.g., "SearchProductsQuery"
        refresh_mode: "OnLoad"       # OnLoad | OnAction | Polling
        refresh_trigger_action_id: ""# optional
        validation_mode: "Both"      # Client | Server | Both
        performance_expectation_ms: 300 # optional guideline (UX constraints)
        caching: ""                  # none | memory | etag | localStorage (enums.caching_strategy)

  information_blocks:
    - id: ""                 # "blk-results"
      name: ""
      importance: "Primary"  # Critical|Primary|Secondary|Reference
      layout: "table"        # table|card|list|inline|alert|tabs|accordion
      data_binding_id: ""    # link to data.bindings.id
      visible_conditions: [] # optional: ["HasResults"]
      fields:
        - label: ""
          value_ref: ""      # e.g., "product.name"
          format: ""         # optional: currency/date/etc
      interactions:
        - type: ""           # e.g., "row_click"
          action_id: ""      # link to action

  form_fields:
    layout: "two_column"     # single_column|two_column|wizard|inline
    fields:
      - id: ""               # "fld-query"
        label: ""
        type: "text"         # enums.field_type
        required: false
        placeholder: ""
        help_text: ""
        value_binding_ref: "" # e.g., "SearchCriteria.Query"
        validation:
          - rule: ""          # e.g., "maxLength:100"
            message: ""
        component_hint: ""    # optional Mud override / e.g., "MudAutocomplete"

  main_actions:
    - id: ""                  # "act-search"
      name: ""                # button label
      intent: ""              # e.g., "Search" | "Create" | "Delete"
      is_destructive: false   # ★ Explicit flag for destructive operations (Delete, Remove, Cancel, etc.)
      priority: "Primary"     # Primary|Secondary|Tertiary
      frequency: "High"       # VeryHigh|High|Medium|Low|Rare
      reversibility: "Reversible"
      error_cost: "Low"
      confirmation_level: ""  # MUST be derivation output unless overridden with reason
      confirmation_override_reason: "" # optional
      disabled_when:
        - condition: ""       # e.g., "!Product.CanDelete()"
          boundary_decision_ref: "" # e.g., "Product.CanDelete()"
      executes:
        - type: "Command"     # Command|Navigation|LocalEvent
          ref: ""             # e.g., "SearchProductsCommand"
      success_feedback: ""    # e.g., "Snackbar"
      failure_feedback: ""    # e.g., "MudAlert"
      component_hint: ""      # optional override

  secondary_actions:
    - id: ""
      name: ""
      intent: ""
      is_destructive: false   # ★ Explicit flag for destructive operations
      priority: "Secondary"
      frequency: "Medium"
      reversibility: "Reversible"
      error_cost: "Low"
      confirmation_level: ""
      executes:
        - type: "LocalEvent"
          ref: ""
      component_hint: ""

  ux_constraints:
    first_paint_target_ms: 300
    action_response_target_ms: 500
    max_initial_scroll: 0
    accessibility:
      keyboard_navigation: true
      aria_labels_required: true
    i18n:
      supported_locales: ["ja-JP"]
    telemetry:
      track_actions: true
      track_errors: true

# -----------------------------------------------------------------------------
# Example: ProductSearch (usage example)
# -----------------------------------------------------------------------------
examples:
  - screen:
      id: "product.search"
      name: "Product Search"
      purpose: "商品を検索して詳細を開く"
      primary_user_intent: "最短で商品を見つけ、詳細へ移動する"
      personas: ["User"]
      entry_conditions: ["UserAuthenticated"]
      exit_conditions: ["NavigatedToProductDetail"]
      notes: "検索は高頻度。結果はテーブル表示が最適。"

    data:
      bindings:
        - id: "products.search"
          source_kind: "Query"
          source_ref: "SearchProductsQuery"
          refresh_mode: "OnAction"
          refresh_trigger_action_id: "act-search"
          validation_mode: "Both"
          performance_expectation_ms: 300
          caching: "etag"

    form_fields:
      layout: "two_column"
      fields:
        - id: "fld-query"
          label: "キーワード"
          type: "search"
          required: false
          placeholder: "商品名 / SKU"
          help_text: "部分一致で検索できます"
          value_binding_ref: "SearchCriteria.Query"
          validation:
            - rule: "maxLength:100"
              message: "100文字以内で入力してください"
          component_hint: "MudAutocomplete"

    information_blocks:
      - id: "blk-results"
        name: "検索結果"
        importance: "Primary"
        layout: "table"
        data_binding_id: "products.search"
        fields:
          - label: "商品名"
            value_ref: "product.name"
          - label: "SKU"
            value_ref: "product.sku"
          - label: "在庫"
            value_ref: "product.stock"
        interactions:
          - type: "row_click"
            action_id: "act-open-detail"

    main_actions:
      - id: "act-search"
        name: "検索"
        intent: "Search"
        priority: "Primary"
        frequency: "VeryHigh"
        reversibility: "Reversible"
        error_cost: "Low"
        confirmation_level: "None"
        executes:
          - type: "Command"
            ref: "SearchProductsCommand"
        success_feedback: "Snackbar"
        failure_feedback: "MudAlert"
        component_hint: 'MudButton(Variant="Filled", Color="Primary", Size="Large")'

    secondary_actions:
      - id: "act-open-detail"
        name: "詳細を開く"
        intent: "Navigate"
        priority: "Secondary"
        frequency: "High"
        reversibility: "Reversible"
        error_cost: "Low"
        confirmation_level: "None"
        executes:
          - type: "Navigation"
            ref: "product.detail/{id}"
        component_hint: "row_click"

    ux_constraints:
      first_paint_target_ms: 300
      action_response_target_ms: 500
      max_initial_scroll: 0
      accessibility:
        keyboard_navigation: true
        aria_labels_required: true
      i18n:
        supported_locales: ["ja-JP"]
      telemetry:
        track_actions: true
        track_errors: true

# -----------------------------------------------------------------------------
# AI Guidance
# -----------------------------------------------------------------------------
ai_guidance:
  when_to_use:
    - "ICONIX Boundary から UI を生成する際"
    - "既存画面の UX 品質を評価・改善する際"
    - "MudBlazor コンポーネントの選択に迷った際"
    - "モデルの成熟度に応じてUI表現を段階化する際（vNext）"

  # vNext: Maturity-based generation workflow
  maturity_based_generation:
    principle: |
      モデルの具体度（成熟度）に応じて、UI表現の抽象度を段階的に下げる。
      これにより、情報が足りない段階で具体UIを選ぶ破綻を防ぐ。

    why_this_matters:
      - "Boundary が Intent 中心の段階で Tab 構成を決めると、関心事の分割根拠がない"
      - "モデルが具体化するほど「排他性」「比較性」が確定する"
      - "Tab が成立する条件は「同一対象」「複数の関心事」「同時表示しない合理性」"

    maturity_levels:
      boundary:
        description: "Intent中心・曖昧"
        allowed_ui: "Flow / Section / Card"
        characteristics:
          - "ユーザーの意図（Intent）が主"
          - "属性や操作が不明確"
        example_condition: "Boundary に Intent しか定義されていない"

      entity:
        description: "Entity属性・操作明確"
        allowed_ui: "+ Grid / Accordion / Grouping"
        characteristics:
          - "Entity の属性が確定"
          - "入力項目が明確"
          - "操作（Command）が定義済み"
        example_condition: "data-model.md に属性定義があり、form_fields が埋まっている"

      view:
        description: "View確定・責務明確"
        allowed_ui: "+ Tab / Master-Detail / Stepper"
        characteristics:
          - "関心領域（concerns）が安定"
          - "状態遷移が確定"
          - "画面責務が固定化"
        example_condition: "concerns が前回 plan から変更なし、Entity.CanXxx() が全操作に対応"
        requirement: "stability.concerns_unchanged_since が必須"

    generation_steps:
      - step: 1
        name: "成熟度判定"
        action: "モデルの具体度から maturity.level を決定"
        rules:
          - "属性未確定 → boundary"
          - "属性確定・concerns未安定 → entity"
          - "concerns安定・stability証拠あり → view"

      - step: 2
        name: "defaults 注入"
        action: "maturity_defaults[level] を uiPolicy にコピー"
        note: "出力 UI-IR は自己完結（外部参照なし）"

      - step: 3
        name: "structure 構築"
        action: "concerns を定義し、information_blocks と紐付け"
        rules:
          - "各 concern の exclusivity を評価"
          - "comparability があれば mode と key を設定"

      - step: 4
        name: "Lint 実行"
        action: "ui-ir-lint-rules.yaml に基づき検証"
        output: "pass | fail | pass_with_waivers"

  output_philosophy:
    principle: >
      UI-IR は「完成したUI」ではなく「組み替え可能な構造」を出力する。
      AI は論理的完全性（機能・要素の網羅性）を担保し、
      レイアウトの最終調整は人間に委ねる。

    ai_responsibility:
      - 必要な入力項目が漏れていない
      - 操作がユースケースを完全にカバーしている
      - 状態遷移とUIが矛盾しない
      - エラーケースが露出している

    human_responsibility:
      - 配置の好み
      - 情緒的な分かりやすさ
      - 強調・省略のバランス
      - 組織文化への適合

    layout_flexibility:
      - レイアウト指定は「推奨」であり「強制」ではない
      - importance/priority は参考情報として提供
      - component_hint は上書き可能

  generation_workflow:
    step1:
      name: "UI-IR作成"
      description: "ICONIX Boundary（Intent, Entity.CanXxx()）からUI-IRを記述"
    step2:
      name: "ワイヤーフレーム生成"
      description: "UI-IR の rules セクションと ux_review セクションを厳守してテキストワイヤーフレームを出力"
    step3:
      name: "UX自己評価"
      description: "ux_review.mandatory_checks を満たすか検査。違反があれば修正"
    step4:
      name: "MudBlazor実装"
      description: "component_mapping に従って Razor コンポーネントを生成"

  critical_rules:
    - "Primary アクションは画面に1つのみ"
    - "confirmation_level は derivation rules から自動算出（オーバーライド時は理由を明記）"
    - "Critical importance の情報はファーストビューに配置"
    - "Entity.CanXxx() がある場合は disabled_when で参照"
    - "削除・キャンセル等の破壊的操作は is_destructive: true を明示"

  common_mistakes:
    - mistake: "全てのアクションを Primary にする"
      solution: "Primary は画面の主目的を達成する1アクションのみ。他は Secondary/Tertiary"
    - mistake: "confirmation_level を手動で決める"
      solution: "derivation rules を適用。オーバーライドには理由が必要"
    - mistake: "error_cost=High なのに確認ダイアログがない"
      solution: "derivation rules で Detailed 以上が必須"
    - mistake: "VeryHigh 操作がメニュー内に隠れている"
      solution: "max_clicks: 1 ルールに違反。プライマリボタンとして配置"
    - mistake: "削除ボタンに is_destructive フラグを設定しない"
      solution: "Delete, Remove, Cancel, Reject 等の破壊的操作は is_destructive: true を明示。danger_overrides でスタイルが自動適用される"

    # vNext: Maturity-related mistakes
    - mistake: "boundary/entity レベルで Tab を使用する"
      solution: "Tab は view レベルでのみ許可。boundary/entity では accordion や inline-sections を使用"
      vNext: true
    - mistake: "view レベルなのに stability が未設定"
      solution: "view レベルには concerns_unchanged_since が必須。plan 参照を設定する"
      vNext: true
    - mistake: "exclusivity=true の concern が複数あるのに exclusive-switch を許可しない"
      solution: "排他的関心領域が複数ある場合、uiPolicy.allowed_affordances に 'exclusive-switch' を追加"
      vNext: true
    - mistake: "comparability を定義したのに comparison affordance がない"
      solution: "比較表示が必要な concern には uiPolicy.allowed_affordances に 'comparison' を追加"
      vNext: true
    - mistake: "information_block が concerns から参照されていない（孤立ブロック）"
      solution: "全ての information_blocks は最低1つの concern から参照されるべき。不要なら削除、意図的なら override を追加"
      vNext: true
    - mistake: "uiPolicyOverrides に approved_by がない"
      solution: "全ての override には承認者（approved_by）が必須。監査のため空欄禁止"
      vNext: true

# -----------------------------------------------------------------------------
# Changelog
# -----------------------------------------------------------------------------
changelog:
  - version: 0.2.0
    date: 2025-12-13
    changes:
      - "vNext: 成熟度（maturity）ベースのUI語彙制約を導入"
      - "maturity セクション追加（level, gate_evidence, stability）"
      - "structure セクション追加（subject, concerns with exclusivity/comparability）"
      - "uiPolicy セクション追加（allowed_patterns/affordances/widgets, denied_widgets）"
      - "uiPolicyOverrides セクション追加（例外承認システム）"
      - "maturity_defaults 定義（boundary/entity/view ごとのデフォルト値）"
      - "UX review に成熟度チェック（UX-006〜UX-010）を追加"
      - "AI guidance に maturity_based_generation ワークフローを追加"
      - "common_mistakes に成熟度関連のミスを追加"
      - "enums に maturity_level, comparability_mode, override_scope, widgets を追加"

  - version: 0.1.0
    date: 2025-12-13
    changes:
      - "初版リリース"
      - "ICONIXバウンダリーからUI生成への橋渡しとして設計"
      - "MudBlazor固定のコンポーネントマッピング"
      - "confirmation_level 自動算出ルール"
      - "UXレビューチェックリスト"
      - "ProductSearch の使用例"
