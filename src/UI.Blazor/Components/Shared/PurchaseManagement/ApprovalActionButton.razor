@using Domain.PurchaseManagement.Boundaries
@inject IJSRuntime JSRuntime

<button type="button"
        class="btn btn-@Action.ColorTheme"
        disabled="@(!Action.IsEnabled)"
        @onclick="HandleClick"
        aria-label="@Action.AriaLabel"
        title="@(Action.DisabledReason ?? Action.Label)">
    <i class="bi bi-@Action.Icon"></i>
    @Action.Label
</button>

@code {
    [Parameter, EditorRequired]
    public ApprovalAction Action { get; set; } = null!;

    [Parameter]
    public EventCallback<ApprovalAction> OnClick { get; set; }

    private async Task HandleClick()
    {
        if (!Action.IsEnabled)
            return;

        if (Action.RequiresConfirmation)
        {
            try
            {
                var confirmationMessage = !string.IsNullOrEmpty(Action.ConfirmationMessage)
                    ? Action.ConfirmationMessage
                    : $"Are you sure you want to {Action.Label.ToLower()}?";

                var confirmed = await JSRuntime.InvokeAsync<bool>("confirm", confirmationMessage);

                if (!confirmed)
                    return;
            }
            catch (Exception ex)
            {
                // JS interop failed - treat as cancelled for safety
                Console.WriteLine($"Confirmation dialog failed: {ex.Message}");
                return;
            }
        }

        await OnClick.InvokeAsync(Action);
    }
}
