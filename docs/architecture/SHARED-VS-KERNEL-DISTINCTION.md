# Shared vs Kernel - ä½¿ã„åˆ†ã‘ã‚¬ã‚¤ãƒ‰

## ğŸ“ éšå±¤æ§‹é€ 

```
src/
â”œâ”€â”€ Shared/                          â† â˜… BCæ¨ªæ–­ã®å…±æœ‰ã‚³ãƒ¼ãƒ‰ï¼ˆå…¨BCå…±é€šï¼‰
â”‚   â”œâ”€â”€ Kernel/                      â† ç´”ç²‹ãªæŠ€è¡“çš„åŸºç›¤ï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãªã—ï¼‰
â”‚   â”‚   â”œâ”€â”€ Entity.cs
â”‚   â”‚   â”œâ”€â”€ ValueObject.cs
â”‚   â”‚   â”œâ”€â”€ AggregateRoot.cs
â”‚   â”‚   â”œâ”€â”€ DomainEvent.cs
â”‚   â”‚   â”œâ”€â”€ DomainException.cs
â”‚   â”‚   â”œâ”€â”€ DomainError.cs
â”‚   â”‚   â””â”€â”€ Money.cs
â”‚   â”‚
â”‚   â”œâ”€â”€ Domain/                      â† å…¨BCå…±é€šã®ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜ï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚ã‚Šï¼‰
â”‚   â”‚   â”œâ”€â”€ Identity/
â”‚   â”‚   â”‚   â”œâ”€â”€ ApplicationUser.cs  â† èªè¨¼ãƒ»èªå¯ï¼ˆå…¨BCã§å…±é€šï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ Roles.cs
â”‚   â”‚   â”œâ”€â”€ Outbox/
â”‚   â”‚   â”‚   â””â”€â”€ OutboxMessage.cs    â† ã‚¤ãƒ™ãƒ³ãƒˆé…ä¿¡ï¼ˆå…¨BCã§å…±é€šï¼‰
â”‚   â”‚   â”œâ”€â”€ AuditLogs/
â”‚   â”‚   â”‚   â””â”€â”€ AuditLog.cs         â† ç›£æŸ»ãƒ­ã‚°ï¼ˆå…¨BCã§å…±é€šï¼‰
â”‚   â”‚   â”œâ”€â”€ Idempotency/
â”‚   â”‚   â”‚   â””â”€â”€ IdempotencyRecord.cs
â”‚   â”‚   â””â”€â”€ StateMachine/
â”‚   â”‚       â”œâ”€â”€ IStateMachine.cs
â”‚   â”‚       â””â”€â”€ InvalidStateTransitionException.cs
â”‚   â”‚
â”‚   â”œâ”€â”€ Application/
â”‚   â””â”€â”€ Infrastructure/
â”‚
â”œâ”€â”€ PurchaseManagement/              â† â˜… BCï¼ˆå¢ƒç•Œã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼‰
â”‚   â”œâ”€â”€ Features/                    â† å‚ç›´ã‚¹ãƒ©ã‚¤ã‚¹ç¾¤
â”‚   â”‚   â”œâ”€â”€ ApprovePurchaseRequest/
â”‚   â”‚   â”œâ”€â”€ GetPurchaseRequestById/
â”‚   â”‚   â””â”€â”€ SubmitPurchaseRequest/
â”‚   â”‚
â”‚   â”œâ”€â”€ Shared/                      â† â˜… BCå†…ã®å…±æœ‰ã‚³ãƒ¼ãƒ‰ï¼ˆã“ã®BCå†…ã®ã¿ï¼‰
â”‚   â”‚   â”œâ”€â”€ Domain/                  â† BCå›ºæœ‰ã®ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜
â”‚   â”‚   â”‚   â””â”€â”€ PurchaseRequests/
â”‚   â”‚   â”‚       â”œâ”€â”€ PurchaseRequest.cs
â”‚   â”‚   â”‚       â”œâ”€â”€ ApprovalStep.cs
â”‚   â”‚   â”‚       â””â”€â”€ Boundaries/
â”‚   â”‚   â”‚           â”œâ”€â”€ ApprovalBoundaryService.cs
â”‚   â”‚   â”‚           â””â”€â”€ UIMetadata.cs
â”‚   â”‚   â”œâ”€â”€ Application/
â”‚   â”‚   â”œâ”€â”€ Infrastructure/
â”‚   â”‚   â””â”€â”€ UI/
â”‚   â”‚
â”‚   â””â”€â”€ Infrastructure/
â”‚
â””â”€â”€ ProductCatalog/                  â† â˜… åˆ¥ã®BCï¼ˆå¢ƒç•Œã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼‰
    â”œâ”€â”€ Features/
    â””â”€â”€ Shared/                      â† ã“ã®BCå†…ã®å…±æœ‰ã‚³ãƒ¼ãƒ‰
        â””â”€â”€ Domain/
```

**é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ:**
- `src/Shared/` = **BCæ¨ªæ–­**ã®å…±æœ‰ï¼ˆå…¨BCå…±é€šï¼‰
- `src/PurchaseManagement/Shared/` = **PurchaseManagement BCå†…**ã®å…±æœ‰ï¼ˆã“ã®BCå†…ã®ã¿ï¼‰
- `src/ProductCatalog/Shared/` = **ProductCatalog BCå†…**ã®å…±æœ‰ï¼ˆã“ã®BCå†…ã®ã¿ï¼‰
- åŒã˜ `Shared` ã¨ã„ã†åå‰ã ãŒã€**ã‚¹ã‚³ãƒ¼ãƒ—ãŒå…¨ãç•°ãªã‚‹**

**3ã¤ã®ã€ŒShared/Domainã€:**
1. `src/Shared/Domain/` â†’ å…¨BCå…±é€šï¼ˆApplicationUserã€OutboxMessageï¼‰
2. `src/PurchaseManagement/Shared/Domain/` â†’ PurchaseManagement BCå›ºæœ‰ï¼ˆPurchaseRequestï¼‰
3. `src/ProductCatalog/Shared/Domain/` â†’ ProductCatalog BCå›ºæœ‰ï¼ˆProductï¼‰

---

## ğŸ¯ ä½¿ã„åˆ†ã‘ã®åŸå‰‡

### âœ… `Shared/Kernel/` ã«é…ç½®ã™ã¹ãã‚‚ã®

**å®šç¾©:** **ç´”ç²‹ãªæŠ€è¡“çš„åŸºç›¤** - ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’ä¸€åˆ‡å«ã¾ãªã„ã€DDDã®åŸºç¤ã‚¯ãƒ©ã‚¹

#### ç‰¹å¾´:
1. âœ… **ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãªã—** - æŠ€è¡“çš„ãªæŠ½è±¡åŒ–ã®ã¿
2. âœ… **å…¨BCã§ä½¿ç”¨** - ã™ã¹ã¦ã®å¢ƒç•Œã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰å‚ç…§ã•ã‚Œã‚‹
3. âœ… **å®‰å®šã—ã¦ã„ã‚‹** - å¤‰æ›´é »åº¦ãŒæ¥µã‚ã¦ä½ã„
4. âœ… **å†åˆ©ç”¨æ€§ãŒé«˜ã„** - ã©ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã§ã‚‚åŒã˜æ„å‘³ã§ä½¿ãˆã‚‹

#### å…·ä½“ä¾‹:

| ãƒ•ã‚¡ã‚¤ãƒ« | ç†ç”± |
|---------|------|
| **Entity.cs** | DDDã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®æŠ½è±¡åŸºåº•ã‚¯ãƒ©ã‚¹ï¼ˆæŠ€è¡“çš„åŸºç›¤ï¼‰ |
| **ValueObject.cs** | DDDå€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æŠ½è±¡åŸºåº•ã‚¯ãƒ©ã‚¹ï¼ˆæŠ€è¡“çš„åŸºç›¤ï¼‰ |
| **AggregateRoot.cs** | DDDé›†ç´„ãƒ«ãƒ¼ãƒˆã®æŠ½è±¡åŸºåº•ã‚¯ãƒ©ã‚¹ï¼ˆæŠ€è¡“çš„åŸºç›¤ï¼‰ |
| **DomainEvent.cs** | ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã®æŠ½è±¡åŸºåº•ã‚¯ãƒ©ã‚¹ï¼ˆæŠ€è¡“çš„åŸºç›¤ï¼‰ |
| **DomainException.cs** | ãƒ‰ãƒ¡ã‚¤ãƒ³ä¾‹å¤–ã®æŠ½è±¡åŸºåº•ã‚¯ãƒ©ã‚¹ï¼ˆæŠ€è¡“çš„åŸºç›¤ï¼‰ |
| **DomainError.cs** | ã‚¨ãƒ©ãƒ¼è¡¨ç¾ã®å…±é€šå‹ï¼ˆæŠ€è¡“çš„åŸºç›¤ï¼‰ |
| **Money.cs** | é‡‘é¡å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆ**BCæ¨ªæ–­ã§å…±é€šã®æ„å‘³**ï¼‰ |

#### Money ãŒ Kernel ã«ã‚ã‚‹ç†ç”±:

```csharp
// Money ã¯ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å«ã‚€ãŒã€å…¨BCã§åŒã˜æ„å‘³ã§ä½¿ã‚ã‚Œã‚‹
namespace Shared.Kernel;

/// <summary>
/// ã€Shared.Kernelé…ç½®ç†ç”±ã€‘
/// - Money ã¯è¤‡æ•°ã® Bounded Context ã§ä½¿ç”¨ã•ã‚Œã‚‹å…±é€šã®å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
/// - ProductCatalog BC ã¨ PurchaseManagement BC ã®ä¸¡æ–¹ã§å¿…è¦
/// - BCé–“ã®ä¾å­˜ã‚’é¿ã‘ã‚‹ãŸã‚ã€Shared.Kernel ã«é…ç½®
/// </summary>
public sealed class Money : ValueObject
{
    public decimal Amount { get; }
    public string Currency { get; }
}
```

**é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ:**
- `Money` ã¯ä¾‹å¤–çš„ã« **è»½é‡ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯** ã‚’å«ã‚€
- ã—ã‹ã— **å…¨BCã§åŒã˜æ„å‘³** ã§ä½¿ã‚ã‚Œã‚‹ï¼ˆ"é‡‘é¡"ã®æ¦‚å¿µã¯æ™®éçš„ï¼‰
- BCå›ºæœ‰ã®é‡‘é¡ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆä¾‹: ä¾¡æ ¼è¨ˆç®—ãƒ«ãƒ¼ãƒ«ï¼‰ã¯å«ã¾ãªã„

---

### âœ… `Shared/Domain/` ã«é…ç½®ã™ã¹ãã‚‚ã®

**å®šç¾©:** **å…¨BCå…±é€šã®ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜** - ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å«ã‚€ãŒã€BCæ¨ªæ–­ã§å¿…è¦

#### ç‰¹å¾´:
1. âœ… **ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚ã‚Š** - å…·ä½“çš„ãªãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜ã‚’å«ã‚€
2. âœ… **å…¨BCã§ä½¿ç”¨** - ã™ã¹ã¦ã®å¢ƒç•Œã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰å‚ç…§ã•ã‚Œã‚‹
3. âœ… **ã‚¤ãƒ³ãƒ•ãƒ©çš„ãªæ€§è³ª** - èªè¨¼ã€ç›£æŸ»ã€ã‚¤ãƒ™ãƒ³ãƒˆé…ä¿¡ãªã©
4. âœ… **å¤‰æ›´é »åº¦ãŒä½ã„** - æ¯”è¼ƒçš„å®‰å®šã—ãŸãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜

#### å…·ä½“ä¾‹:

| ãƒ•ã‚¡ã‚¤ãƒ« | ç†ç”± | ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ |
|---------|------|------------------|
| **ApplicationUser.cs** | å…¨BCã§å…±é€šã®èªè¨¼ãƒ»èªå¯ | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æœ‰åŠ¹æ€§åˆ¤å®š (`IsActive`) |
| **Roles.cs** | å…¨BCã§å…±é€šã®ãƒ­ãƒ¼ãƒ«å®šç¾© | ãƒ­ãƒ¼ãƒ«åã¨ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ |
| **OutboxMessage.cs** | å…¨BCã§å…±é€šã®ã‚¤ãƒ™ãƒ³ãƒˆé…ä¿¡ | ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯ã€å‡¦ç†å®Œäº†åˆ¤å®š |
| **AuditLog.cs** | å…¨BCã§å…±é€šã®ç›£æŸ»ãƒ­ã‚° | ç›£æŸ»å¯¾è±¡ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®å®šç¾© |
| **IdempotencyRecord.cs** | å…¨BCã§å…±é€šã®ã¹ãç­‰æ€§ä¿è¨¼ | ã¹ãç­‰æ€§ãƒã‚§ãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯ |
| **IStateMachine.cs** | å…¨BCã§å…±é€šã®ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³æŠ½è±¡åŒ– | çŠ¶æ…‹é·ç§»ãƒ«ãƒ¼ãƒ« |

#### ApplicationUser ãŒ Shared/Domain ã«ã‚ã‚‹ç†ç”±:

```csharp
namespace Shared.Domain.Identity;

/// <summary>
/// ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼
/// ASP.NET Core Identity ã® IdentityUser ã‚’ç¶™æ‰¿
/// </summary>
public sealed class ApplicationUser : IdentityUser<Guid>
{
    public string DisplayName { get; set; }
    public DateTime CreatedAtUtc { get; set; }
    public bool IsActive { get; set; } = true;  // â† ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
}
```

**é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ:**
- `IsActive` ã¨ã„ã† **ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«** ã‚’æŒã¤
- ã—ã‹ã—ã€PurchaseManagement BCã€ProductCatalog BCã€ãã®ä»–ã™ã¹ã¦ã®BCã§ **å…±é€šã®æ„å‘³**
- BCå›ºæœ‰ã®èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆä¾‹: æ‰¿èªè€…åˆ¤å®šï¼‰ã¯å«ã¾ãªã„

---

### âœ… `PurchaseManagement/Shared/Domain/` ã«é…ç½®ã™ã¹ãã‚‚ã®

**å®šç¾©:** **BCå†…å…±é€šã®ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜** - BCå›ºæœ‰ã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯

**å®Ÿéš›ã®ãƒ‘ã‚¹:** `src/PurchaseManagement/Shared/Domain/`

#### ç‰¹å¾´:
1. âœ… **ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚ã‚Š** - BCå›ºæœ‰ã®ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜
2. âœ… **BCå†…ã§ã®ã¿ä½¿ç”¨** - ä»–ã®BCã‹ã‚‰ã¯å‚ç…§ã—ãªã„
3. âœ… **å¤‰æ›´é »åº¦ãŒé«˜ã„** - ãƒ“ã‚¸ãƒã‚¹è¦ä»¶å¤‰æ›´ã§é »ç¹ã«æ›´æ–°
4. âœ… **è¤‡æ•°ã‚¹ãƒ©ã‚¤ã‚¹ã§å…±æœ‰** - BCå†…ã®è¤‡æ•°æ©Ÿèƒ½ï¼ˆFeaturesï¼‰ã‹ã‚‰åˆ©ç”¨

#### å…·ä½“ä¾‹ (PurchaseManagement BC):

| ãƒ•ã‚¡ã‚¤ãƒ« | ãƒ‘ã‚¹ | ç†ç”± |
|---------|------|------|
| **PurchaseRequest.cs** | `src/PurchaseManagement/Shared/Domain/PurchaseRequests/` | PurchaseManagement BCå›ºæœ‰ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ |
| **ApprovalStep.cs** | `src/PurchaseManagement/Shared/Domain/PurchaseRequests/` | PurchaseManagement BCå›ºæœ‰ã®æ‰¿èªã‚¹ãƒ†ãƒƒãƒ— |
| **ApprovalBoundaryService.cs** | `src/PurchaseManagement/Shared/Domain/PurchaseRequests/Boundaries/` | PurchaseManagement BCå›ºæœ‰ã®æ‰¿èªãƒ­ã‚¸ãƒƒã‚¯ |
| **UIMetadata.cs** | `src/PurchaseManagement/Shared/Domain/PurchaseRequests/Boundaries/` | PurchaseManagement BCå›ºæœ‰ã®UIè¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ |

**é‡è¦:**
- `PurchaseManagement/Shared/` ã® `Shared` ã¯ **BCå†…å…±æœ‰** ã‚’æ„å‘³
- `src/Shared/` ã® `Shared` ã¨ã¯ **ç•°ãªã‚‹ã‚¹ã‚³ãƒ¼ãƒ—**

---

## ğŸ” åˆ¤å®šãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ

```
æ–°ã—ã„ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã™ã‚‹å ´åˆã€ã©ã“ã«é…ç½®ã™ã¹ãã‹ï¼Ÿ
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Q1: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å«ã‚€ï¼Ÿ           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“ NOï¼ˆç´”ç²‹ãªæŠ€è¡“çš„åŸºç›¤ï¼‰
  â†’ **src/Shared/Kernel/** ã«é…ç½®

  â†“ YES
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Q2: å…¨BCã§ä½¿ç”¨ã•ã‚Œã‚‹ï¼Ÿ                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“ NOï¼ˆç‰¹å®šã®BCã§ã®ã¿ä½¿ç”¨ï¼‰
  â†’ **src/PurchaseManagement/Shared/Domain/** ã«é…ç½®
     ï¼ˆBCã”ã¨ã«ç•°ãªã‚‹ãƒ‘ã‚¹ï¼‰

  â†“ YES
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Q3: BCæ¨ªæ–­ã§åŒã˜æ„å‘³ã§ä½¿ã‚ã‚Œã‚‹ï¼Ÿ       â”‚
â”‚     ï¼ˆèªè¨¼ã€ç›£æŸ»ã€ã‚¤ãƒ™ãƒ³ãƒˆé…ä¿¡ãªã©ï¼‰    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“ YES
  â†’ **src/Shared/Domain/** ã«é…ç½®

  â†“ NOï¼ˆBCé–“ã§æ„å‘³ãŒç•°ãªã‚‹å¯èƒ½æ€§ï¼‰
  â†’ âŒ è¨­è¨ˆã‚’è¦‹ç›´ã—ï¼šBCé–“ã§å…±æœ‰ã™ã¹ãã§ãªã„
```

---

## ğŸ“Š æ¯”è¼ƒè¡¨

| é …ç›® | `src/Shared/Kernel/` | `src/Shared/Domain/` | `src/PurchaseManagement/Shared/Domain/` |
|------|------------------|------------------|-----------------------|
| **ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯** | âŒ ãªã—ï¼ˆä¾‹å¤–: Moneyï¼‰ | âœ… ã‚ã‚Š | âœ… ã‚ã‚Š |
| **ä½¿ç”¨ç¯„å›²** | å…¨BC | å…¨BC | BCå†…ã®ã¿ |
| **å¤‰æ›´é »åº¦** | æ¥µã‚ã¦ä½ã„ | ä½ã„ | é«˜ã„ |
| **ä¾‹** | Entity, ValueObject, Money | ApplicationUser, OutboxMessage | PurchaseRequest, ApprovalBoundary |
| **ä¾å­˜é–¢ä¿‚** | ãªã—ï¼ˆä»–ã®èª°ã«ã‚‚ä¾å­˜ã—ãªã„ï¼‰ | Kernel ã«ä¾å­˜ | Kernel ã¨ Shared/Domain ã«ä¾å­˜ |

---

## ğŸ¯ å®Ÿä¾‹ã«ã‚ˆã‚‹ç†è§£

### ä¾‹1: Money ã‚¯ãƒ©ã‚¹

**é…ç½®:** `src/Shared/Kernel/Money.cs`

**ç†ç”±:**
- âœ… å…¨BCï¼ˆPurchaseManagement, ProductCatalogï¼‰ã§ä½¿ç”¨
- âœ… å…¨BCã§ **åŒã˜æ„å‘³** ã§ä½¿ã‚ã‚Œã‚‹ï¼ˆ"é‡‘é¡"ã¯æ™®éçš„æ¦‚å¿µï¼‰
- âš ï¸ ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚ã‚Šï¼ˆé€šè²¨å¤‰æ›ã€åŠ ç®—ãƒ»æ¸›ç®—ï¼‰
- âœ… ã—ã‹ã— **BCå›ºæœ‰ã®ãƒ­ã‚¸ãƒƒã‚¯ã¯å«ã¾ãªã„**ï¼ˆä¾¡æ ¼è¨ˆç®—ãƒ«ãƒ¼ãƒ«ãªã—ï¼‰

**åˆ¤å®š:** `src/Shared/Kernel/` ã«é…ç½®ï¼ˆä¾‹å¤–çš„ã«ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å«ã‚€å…±é€šå€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰

---

### ä¾‹2: ApplicationUser ã‚¯ãƒ©ã‚¹

**é…ç½®:** `src/Shared/Domain/Identity/ApplicationUser.cs`

**ç†ç”±:**
- âœ… å…¨BCï¼ˆPurchaseManagement, ProductCatalogï¼‰ã§ä½¿ç”¨
- âœ… å…¨BCã§ **åŒã˜æ„å‘³** ã§ä½¿ã‚ã‚Œã‚‹ï¼ˆ"ãƒ¦ãƒ¼ã‚¶ãƒ¼"ã¯å…±é€šæ¦‚å¿µï¼‰
- âœ… ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚ã‚Šï¼ˆ`IsActive`ã€æœ‰åŠ¹æ€§åˆ¤å®šï¼‰
- âœ… ã—ã‹ã— **BCå›ºæœ‰ã®ãƒ­ã‚¸ãƒƒã‚¯ã¯å«ã¾ãªã„**ï¼ˆæ‰¿èªè€…åˆ¤å®šãªã—ï¼‰

**åˆ¤å®š:** `src/Shared/Domain/` ã«é…ç½®ï¼ˆå…¨BCå…±é€šã®ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜ï¼‰

---

### ä¾‹3: PurchaseRequest ã‚¯ãƒ©ã‚¹

**é…ç½®:** `src/PurchaseManagement/Shared/Domain/PurchaseRequests/PurchaseRequest.cs`

**ç†ç”±:**
- âŒ PurchaseManagement BC ã§ã®ã¿ä½¿ç”¨
- âœ… ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚ã‚Šï¼ˆæ‰¿èªãƒ•ãƒ­ãƒ¼ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é·ç§»ï¼‰
- âœ… **BCå›ºæœ‰ã®ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜**ï¼ˆè³¼è²·ç”³è«‹ã¯ PurchaseManagement BC å›ºæœ‰ï¼‰

**åˆ¤å®š:** `src/PurchaseManagement/Shared/Domain/` ã«é…ç½®ï¼ˆBCå›ºæœ‰ã®ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜ï¼‰

---

### ä¾‹4: ApprovalBoundaryService ã‚¯ãƒ©ã‚¹

**é…ç½®:** `src/PurchaseManagement/Shared/Domain/PurchaseRequests/Boundaries/ApprovalBoundaryService.cs`

**ç†ç”±:**
- âŒ PurchaseManagement BC ã§ã®ã¿ä½¿ç”¨
- âœ… ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚ã‚Šï¼ˆæ‰¿èªè³‡æ ¼åˆ¤å®šã€UIãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆï¼‰
- âœ… **BCå›ºæœ‰ã®ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜**ï¼ˆæ‰¿èªãƒ«ãƒ¼ãƒ«ã¯ PurchaseManagement BC å›ºæœ‰ï¼‰

**åˆ¤å®š:** `src/PurchaseManagement/Shared/Domain/` ã«é…ç½®ï¼ˆBCå›ºæœ‰ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ï¼‰

---

## ğŸš« ã‚ˆãã‚ã‚‹èª¤è§£

### èª¤è§£1: ã€ŒKernelã¯ã‚¤ãƒ³ãƒ•ãƒ©å±¤ã€

**âŒ é–“é•ã„:**
```
Kernel = ã‚¤ãƒ³ãƒ•ãƒ©å±¤ = æŠ€è¡“çš„ãªå®Ÿè£…è©³ç´°
```

**âœ… æ­£è§£:**
```
Kernel = ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®åŸºç›¤ = DDDã®æŠ½è±¡åŒ– + å…±é€šå€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
- Entity, ValueObject ã¯ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã®æŠ½è±¡åŸºåº•ã‚¯ãƒ©ã‚¹
- Money ã¯å…¨BCã§å…±é€šã®å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
```

---

### èª¤è§£2: ã€ŒShared/Domainã¯å…¨BCã®ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã®ç½®ãå ´æ‰€ã€

**âŒ é–“é•ã„:**
```
Shared/Domain/ ã«å…¨BCã®ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã‚’é…ç½®ã™ã‚Œã°ã‚ˆã„
```

**âœ… æ­£è§£:**
```
Shared/Domain/ ã¯ã€ŒBCæ¨ªæ–­ã§å…±é€šã®ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜ã€ã®ã¿
- ApplicationUserï¼ˆèªè¨¼ï¼‰
- OutboxMessageï¼ˆã‚¤ãƒ™ãƒ³ãƒˆé…ä¿¡ï¼‰
- AuditLogï¼ˆç›£æŸ»ï¼‰

BCå›ºæœ‰ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã¯ {BC}/Shared/Domain/ ã«é…ç½®
- PurchaseRequest ã¯ PurchaseManagement/Shared/Domain/
- Product ã¯ ProductCatalog/Shared/Domain/
```

---

### èª¤è§£3: ã€Œãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å«ã‚€ã‚‚ã®ã¯Kernelã«ç½®ã‘ãªã„ã€

**âŒ é–“é•ã„:**
```
Money ã¯ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å«ã‚€ã‹ã‚‰ Shared/Domain ã«é…ç½®ã™ã¹ã
```

**âœ… æ­£è§£:**
```
Money ã¯ä¾‹å¤–çš„ã« Kernel ã«é…ç½®
- ç†ç”±: å…¨BCã§ã€ŒåŒã˜æ„å‘³ã€ã§ä½¿ã‚ã‚Œã‚‹æ™®éçš„æ¦‚å¿µ
- BCå›ºæœ‰ã®é‡‘é¡ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆä¾¡æ ¼è¨ˆç®—ãƒ«ãƒ¼ãƒ«ï¼‰ã¯å«ã¾ãªã„
- ValueObject ã‚’ç¶™æ‰¿ã—ã€DDDã®åŸºç›¤ã¨ã—ã¦ã®å½¹å‰²ã‚‚ã‚ã‚‹
```

---

## ğŸ“ è¨­è¨ˆã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³1: ã€ŒBCæ¨ªæ–­ã§å…±æœ‰ã™ã‚‹å‰ã«2å›è€ƒãˆã‚‹ã€

BCé–“ã§å…±æœ‰ã™ã‚‹ã¨ã„ã†ã“ã¨ã¯ã€**å¤‰æ›´å½±éŸ¿ãŒå…¨BCã«åŠã¶** ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚

**ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ:**
- âœ… æœ¬å½“ã«å…¨BCã§åŒã˜æ„å‘³ã§ä½¿ã‚ã‚Œã‚‹ã‹ï¼Ÿ
- âœ… BCå›ºæœ‰ã®ãƒ­ã‚¸ãƒƒã‚¯ã¯å«ã¾ã‚Œã¦ã„ãªã„ã‹ï¼Ÿ
- âœ… å¤‰æ›´é »åº¦ã¯ä½ã„ã‹ï¼Ÿ

**åˆ¤å®š:**
- ã™ã¹ã¦ YES â†’ `Shared/Domain/` ã¾ãŸã¯ `Shared/Kernel/`
- 1ã¤ã§ã‚‚ NO â†’ `{BC}/Shared/Domain/` ã«é…ç½®ã—ç›´ã™

---

### ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³2: ã€ŒKernelã¯æœ€å°é™ã«ä¿ã¤ã€

Kernel ã¯ **æœ€ã‚‚å¤‰æ›´å½±éŸ¿ãŒå¤§ãã„** é ˜åŸŸã§ã™ã€‚

**é…ç½®åŸºæº–:**
- âœ… DDDã®æŠ½è±¡åŸºåº•ã‚¯ãƒ©ã‚¹ï¼ˆEntity, ValueObject, AggregateRootï¼‰
- âœ… æŠ€è¡“çš„åŸºç›¤ï¼ˆDomainEvent, DomainExceptionï¼‰
- âœ… å…¨BCã§å…±é€šã®æ™®éçš„å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆMoneyï¼‰
- âŒ ãã‚Œä»¥å¤–ã¯ Shared/Domain ã«é…ç½®

---

### ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³3: ã€ŒShared/Domainã¯ã‚¤ãƒ³ãƒ•ãƒ©çš„ãªãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜ã€

Shared/Domain ã¯ **"ã‚¤ãƒ³ãƒ•ãƒ©çš„ãªãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜"** ã‚’é…ç½®ã—ã¾ã™ã€‚

**é…ç½®åŸºæº–:**
- âœ… èªè¨¼ãƒ»èªå¯ï¼ˆApplicationUser, Rolesï¼‰
- âœ… ç›£æŸ»ãƒ»ãƒ­ã‚°ï¼ˆAuditLogï¼‰
- âœ… ã‚¤ãƒ™ãƒ³ãƒˆé…ä¿¡ï¼ˆOutboxMessageï¼‰
- âœ… ã¹ãç­‰æ€§ä¿è¨¼ï¼ˆIdempotencyRecordï¼‰
- âŒ ãƒ“ã‚¸ãƒã‚¹ãƒ‰ãƒ¡ã‚¤ãƒ³å›ºæœ‰ã®çŸ¥è­˜ï¼ˆPurchaseRequest, Productï¼‰

---

## ğŸ“ ã¾ã¨ã‚

### 3ã¤ã®Sharedã®ä½¿ã„åˆ†ã‘

| é…ç½®å ´æ‰€ | å®šç¾© | ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ | ä½¿ç”¨ç¯„å›² | ä¾‹ |
|---------|------|------------------|---------|-----|
| **`src/Shared/Kernel/`** | ç´”ç²‹ãªæŠ€è¡“çš„åŸºç›¤ + æ™®éçš„å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ | âŒ ãªã—ï¼ˆä¾‹å¤–: Moneyï¼‰ | å…¨BC | Entity, ValueObject, Money |
| **`src/Shared/Domain/`** | å…¨BCå…±é€šã®ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜ï¼ˆã‚¤ãƒ³ãƒ•ãƒ©çš„ï¼‰ | âœ… ã‚ã‚Š | å…¨BC | ApplicationUser, OutboxMessage |
| **`src/PurchaseManagement/Shared/Domain/`** | BCå›ºæœ‰ã®ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜ | âœ… ã‚ã‚Š | BCå†…ã®ã¿ | PurchaseRequest, ApprovalBoundary |

**é‡è¦:** åŒã˜ã€ŒSharedã€ã§ã‚‚ã€`src/Shared/` ã¨ `src/PurchaseManagement/Shared/` ã¯ã‚¹ã‚³ãƒ¼ãƒ—ãŒç•°ãªã‚Šã¾ã™ã€‚

### åˆ¤å®šãƒ«ãƒ¼ãƒ«

```
1. ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãªã— â†’ src/Shared/Kernel/
2. ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚ã‚Š + å…¨BCå…±é€šï¼ˆã‚¤ãƒ³ãƒ•ãƒ©çš„ï¼‰ â†’ src/Shared/Domain/
3. ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚ã‚Š + BCå›ºæœ‰ â†’ src/{BCå}/Shared/Domain/
```

### è¨­è¨ˆåŸå‰‡

> **`src/Shared/Kernel/` ã¯æœ€å°é™ã«ä¿ã¤ã€‚**
>
> **`src/Shared/Domain/` ã¯ã‚¤ãƒ³ãƒ•ãƒ©çš„ãªãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜ã®ã¿ã€‚**
>
> **BCå›ºæœ‰ã®ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜ã¯ `src/{BCå}/Shared/Domain/` ã«é…ç½®ã€‚**
>
> **BCé–“ã§å…±æœ‰ã™ã‚‹å‰ã«2å›è€ƒãˆã‚‹ã€‚**

---

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **BC-VSA-Sliceé–¢ä¿‚:** `docs/architecture/VSA-BC-SLICE-BOUNDARY-RELATIONSHIP.md`
- **BCæ•´åˆæ€§ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³:** `docs/architecture/BC-CONSISTENCY-GUIDELINES.md`
- **ãƒã‚¦ãƒ³ãƒ€ãƒªãƒ¼é…ç½®ç†ç”±:** `docs/architecture/BOUNDARY-DOMAIN-MODEL-LOCATION.md`
